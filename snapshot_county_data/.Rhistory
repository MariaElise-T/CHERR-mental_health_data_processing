data_merged$X2020.Total.Population <- as.numeric(gsub(",", "", data_merged$X2020.Total.Population))
########################################################
# Opioid Merge
########################################################
opioids_per_100_2020 <- read.csv("data_raw/opioids_per_100_2020.csv")
opioids_per_100_2020$FIPS <- str_pad(opioids_per_100_2020$FIPS, 5, "left", "0")
opioids_per_100_2020 <- subset(opioids_per_100_2020, select = -c(State, County))
data_merged <- merge(data_merged, opioids_per_100_2020, by.x="fips", by.y="FIPS", all.x=T)
########################################################
# Bars per Capita Merge
########################################################
# Import county pops
county_pops <- read.csv("data_raw/co-est2021-pop-48.csv")
county_pops <- county_pops[,c(1:2)]
colnames(county_pops) <- c("County", "ESTIMATESBASE2020")
county_pops$County <- gsub("\\.", "", county_pops$County)
# Import bars per county
census_2020_bars_by_county <- read.csv("data_raw/CBP_2020_alcohol_establishments.csv")
census_2020_bars_by_county = census_2020_bars_by_county[which(census_2020_bars_by_county$EMPSZES_LABEL == 'All establishments'),]
census_2020_bars_by_county = census_2020_bars_by_county[,c("NAME", "ESTAB")]
# Merge population and bars DFs
pop_bars <- merge(census_2020_bars_by_county, county_pops, by.x='NAME', by.y='County', all.y=T)
pop_bars$ESTIMATESBASE2020 <- gsub("\\,", "", pop_bars$ESTIMATESBASE2020)
pop_bars$bars_per_capita = 100000*as.numeric(pop_bars$ESTAB)/as.numeric(pop_bars$ESTIMATESBASE2020)
pop_bars <- pop_bars[,c("NAME", "bars_per_capita")]
pop_bars$NAME <- gsub(" County, Texas", "", pop_bars$NAME)
colnames(pop_bars) <- c("NAME", "alc_est_per_capita")
data_merged <- merge(data_merged, pop_bars, by.x="Name", by.y="NAME", all.x=T)
########################################################
# Veterans Merge
########################################################
VetPop2018 <- read.csv("data_raw/9L_VetPop2018_County.csv")
VetPop2018 <- VetPop2018[,c("County..St", "FIPS", "X9.30.2020")]
VetPop2018$FIPS <- str_pad(VetPop2018$FIPS, 5, pad = "0")
VetPop2018 <- VetPop2018[which(substr(VetPop2018$FIPS, start = 1, stop = 2)=='48'),]
VetPop2018$County..St <- gsub("\\,TX", "", VetPop2018$County..St)
county_pops <- read.csv("data_raw/co-est2021-pop-48.csv")
county_pops <- county_pops[,c(1:2)]
colnames(county_pops) <- c("County", "ESTIMATESBASE2020")
county_pops$County <- gsub("\\.", "", county_pops$County)
county_pops$County <- gsub("\\.", "", county_pops$County)
county_pops$County <- gsub("\\ County, Texas", "", county_pops$County)
vet_pop_merged <- merge(VetPop2018, county_pops, by.x="County..St", by.y="County")
vet_pop_merged$X9.30.2020 <- gsub("\\,", "", vet_pop_merged$X9.30.2020)
vet_pop_merged$ESTIMATESBASE2020 <- gsub("\\,", "", vet_pop_merged$ESTIMATESBASE2020)
vet_pop_merged$vet_percent_2020 <- 100*as.numeric(vet_pop_merged$X9.30.2020)/as.numeric(vet_pop_merged$ESTIMATESBASE2020)
vet_pop_merged <- vet_pop_merged[,c("FIPS", "vet_percent_2020")]
data_merged <- merge(data_merged, vet_pop_merged, by.x="fips", by.y="FIPS", all.x=T)
########################################################
# Health Insurance Merge
########################################################
uninsured_by_county <- read_excel("data_raw/aspe-uninsured-estimates-by-county.xlsx", sheet = "All Uninsured (%)")
uninsured_by_county <- uninsured_by_county[,c("FIPS Code", "Percent Uninsured" )]
colnames(uninsured_by_county) <- c("FIPS", "percent_uninsured" )
uninsured_by_county$percent_uninsured <- 100*uninsured_by_county$percent_uninsured
data_merged <- merge(data_merged, uninsured_by_county, by.x="fips", by.y="FIPS", all.x=T)
########################################################
# Mental Health Court Cases
########################################################
Mental_Health_Court_Cases <- read_excel("data_raw/Mental_Health_Court_Cases.xlsx", sheet = "2020")
colnames(Mental_Health_Court_Cases) <- c("County", "Temp_MH_Services_NewApp_2020", "Ext_MH_Services_NewApp_2020", "Modification_NewApp_2020", "Auth_Meds_NewApp_2020", "Temp_MH_Services_Hearing_2020", "Ext_MH_Services_Hearing_2020", "Modification_Hearing_2020", "Auth_Meds_Hearing_2020")
data_merged <- merge(data_merged, Mental_Health_Court_Cases, by.x="Name", by.y="County", all.x=T)
data_merged$Temp_MH_Services_NewApp_2020_per100k <- 100000*as.numeric(data_merged$Temp_MH_Services_NewApp_2020)/as.numeric(data_merged$X2020.Total.Population)
data_merged$Ext_MH_Services_NewApp_2020_per100k <- 100000*as.numeric(data_merged$Ext_MH_Services_NewApp_2020)/as.numeric(data_merged$X2020.Total.Population)
data_merged$Modification_NewApp_2020_per100k <- 100000*as.numeric(data_merged$Modification_NewApp_2020)/as.numeric(data_merged$X2020.Total.Population)
data_merged$Auth_Meds_NewApp_2020_per100k <- 100000*as.numeric(data_merged$Auth_Meds_NewApp_2020)/as.numeric(data_merged$X2020.Total.Population)
data_merged$Temp_MH_Services_Hearing_2020_per100k <- 100000*as.numeric(data_merged$Temp_MH_Services_Hearing_2020)/as.numeric(data_merged$X2020.Total.Population)
data_merged$Ext_MH_Services_Hearing_2020_per100k <- 100000*as.numeric(data_merged$Ext_MH_Services_Hearing_2020)/as.numeric(data_merged$X2020.Total.Population)
data_merged$Modification_Hearing_2020_per100k <- 100000*as.numeric(data_merged$Modification_Hearing_2020)/as.numeric(data_merged$X2020.Total.Population)
data_merged$Auth_Meds_Hearing_2020_per100k <- 100000*as.numeric(data_merged$Auth_Meds_Hearing_2020)/as.numeric(data_merged$X2020.Total.Population)
########################################################
# Psychiatrists per Capita
########################################################
texas_psychiatrists_2020 <- read.csv("data_raw/texas_psychiatrists_2020.csv")
texas_psychiatrists_2020 <- texas_psychiatrists_2020[,c("County", "X2020.Psychiatrist.Total", "Ratio.of.Psychiatrists.to.100.000.Population")]
data_merged <- merge(data_merged, texas_psychiatrists_2020, by.x="Name", by.y="County", all.x=T)
########################################################
# Traffic Fatalities
########################################################
texas_traffic_DUI_fatalities <- read_excel("data_raw/Texas_DUI_Fatalities_2019.xlsx", skip = 8)
texas_traffic_DUI_fatalities <- texas_traffic_DUI_fatalities[1:(nrow(texas_traffic_DUI_fatalities)-10),]
colnames(texas_traffic_DUI_fatalities) <- c("county", "BAC_00_count", "BAC_00_percent", "BAC_01_07_count", "BAC_01_07_percent", "BAC_gte_08_count",
"BAC_gte_08_percent", "BAC_gte_01_count", "BAC_gte_01_percent", "BAC_gte_15_count", "BAC_gte_15_percent",
"total_count", "total_percent")
texas_traffic_DUI_fatalities$county <- gsub("Texas - ", "", texas_traffic_DUI_fatalities$county)
texas_traffic_DUI_fatalities <- texas_traffic_DUI_fatalities[,c("county", "total_count", "BAC_gte_08_count", "BAC_gte_08_percent")]
colnames(texas_traffic_DUI_fatalities) <- c("County", "Total Traffic Fatalities", "Total Traffic Fatalities BAC gt 08", "Percent Traffic Fatalities BAC gt 08")
texas_traffic_DUI_fatalities$County <- str_split(texas_traffic_DUI_fatalities$County, " \\(", simplify = TRUE)[,1]
texas_traffic_DUI_fatalities$County <- tolower(texas_traffic_DUI_fatalities$County)
texas_traffic_DUI_fatalities$County <- str_to_title(texas_traffic_DUI_fatalities$County)
texas_traffic_DUI_fatalities[texas_traffic_DUI_fatalities == 'NA'] <- NA
texas_traffic_DUI_fatalities$`Total Traffic Fatalities` <- as.numeric(texas_traffic_DUI_fatalities$`Total Traffic Fatalities`)
texas_traffic_DUI_fatalities$`Total Traffic Fatalities BAC gt 08` <- as.numeric(texas_traffic_DUI_fatalities$`Total Traffic Fatalities BAC gt 08`)
texas_traffic_DUI_fatalities$`Percent Traffic Fatalities BAC gt 08` <- as.numeric(texas_traffic_DUI_fatalities$`Percent Traffic Fatalities BAC gt 08`)
data_merged <- merge(data_merged, texas_traffic_DUI_fatalities, by.x="Name", by.y="County", all.x=T)
data_merged$Traffic_Fatalities_per_100k <- (100000)*data_merged$`Total Traffic Fatalities`/as.numeric(data_merged$X2020.Total.Population)
########################################################
# Buprenorphine
########################################################
Buprenorphine <- read.csv("C:/Users/met48/Desktop/V2.1_CHERR-mental_health_data_processing/snapshot_county_data/data_raw/Buprenorphine-Waivered Providers.csv")
Buprenorphine <- Buprenorphine[which(Buprenorphine$State=='Texas'), colnames(Buprenorphine) %in% c("County", "Total.number.of.waivered.providers", "Patient.capacity", "High.need.for.treatment.services", "Low.to.no.patient.capacity")]
Buprenorphine$County <- gsub(" County", "", Buprenorphine$County)
data_merged <- merge(data_merged, Buprenorphine, by.x="Name", by.y="County", all=T)
########################################################
# Community Health Rankings Lifestyle variables
########################################################
CHR_lifestyle <- read.csv("~/Desktop/CHERR-mental_health_map/snapshot_county_data/data_raw/CHR_lifestyle.csv")
colnames(CHR_lifestyle) <- c("FIPS", "State", "County", "Frequent_Mental_Distress", "Average_Bad_MH_Days", "Deaths_Suicide", "Suicide_Rate_AA", "Perc_Food_Insecure", "Perc_Limited_Acc_Healthy_Foods", "Perc_Physically_Inactive", "Perc_With_Acc_Exercise", "Income_80th", "Income_20th", "Income_Ratio", "Perc_Severe_Housing_Issues", "Dev2019")
CHR_lifestyle <- CHR_lifestyle[, -c(2,3)]
data_merged <- merge(data_merged, CHR_lifestyle, by.x="fips", by.y="FIPS", all=T)
library(readxl)
library(stringr)
#setwd('..')
setwd("/Users/maria/Desktop/CHERR-mental_health_map/snapshot_county_data")
########################################################
# Social/Medical Data Format
########################################################
# Import poverty rates
poverty_rates_2020 <- read_excel("data_raw/est20all.xls", skip = 3)
poverty_rates_2020$fips <- paste(poverty_rates_2020$`State FIPS Code`, poverty_rates_2020$`County FIPS Code`, sep='')
# Import chronic conditions
chronic_conditions_2018 <- read_excel("data_raw/County_Table_Chronic_Conditions_Prevalence_by_Age_2018.xlsx", sheet = "All Beneficiaries")
colnames(chronic_conditions_2018) <- c("state", "county", "fips", "Alcohol_Abuse", "Alzheimers_Disease_Dementia",
"Arthritis","Asthma",	"Atrial_Fibrillation",	"Autism_Spectrum_Disorders",
"Cancer",	"Chronic_Kidney_Disease",	"COPD",	"Depression", 	"Diabetes",
"Drug_Abuse_Substance_Abuse",	"HIV_AIDS",	"Heart_Failure", "Hepatitis_B_and_C",
"Hyperlipidemia",	"Hypertension",	"Ischemic_Heart_Disease",	"Osteoporosis",
"Schizophrenia_Other_Psychotic_Disorders", "Stroke")
chronic_conditions_2018 <- chronic_conditions_2018[6:nrow(chronic_conditions_2018),]
# Import unemployment
unemployment <- read.csv("data_raw/laucntycur14.txt", header=FALSE, sep="|")
colnames(unemployment) <- c("LAUS_area_code", "state_fips", "county_fips", "county", "period", "employed", "unemployed", "level", "rate")
unemployment <- unemployment[7:nrow(unemployment),]
unemployment$fips <- paste(unemployment$state_fips, unemployment$county_fips, sep='')
unemployment$fips <- gsub(" ", "", unemployment$fips, fixed = TRUE)
unemployment <- unemployment[which(unemployment$period=="   Mar-22  "),]
# Import incarceration
incarceration_trends <- read.csv("data_raw/incarceration-trends/incarceration_trends_texas_2018.csv")
incarceration_trends$fips <- str_pad(incarceration_trends$fips, 5, pad = "0")
# Data merge
social_medical <- merge(poverty_rates_2020, chronic_conditions_2018, by="fips")
social_medical <- merge(social_medical, unemployment, by="fips")
social_medical <- merge(social_medical, incarceration_trends, by="fips")
# Data prune/save
social_medical <- social_medical[which(social_medical$state.x == 'Texas'),]
social_medical$pov_perc_all <- social_medical$`Poverty Percent, All Ages`
social_medical$pov_perc_under_18 <- social_medical$`Poverty Percent, Age 0-17`
social_medical$pov_perc_under_5 <- social_medical$`Poverty Percent, Age 0-4`
social_medical <- social_medical[,c("fips", "Name", "pov_perc_all",
"pov_perc_under_18", "pov_perc_under_5",
"Alcohol_Abuse","Autism_Spectrum_Disorders",
"Depression", "Drug_Abuse_Substance_Abuse",
"Schizophrenia_Other_Psychotic_Disorders",
"rate", "total_pop", "total_jail_pop",
"total_jail_pretrial")]
social_medical$unemployment <- social_medical$rate
social_medical <- social_medical[,which(!colnames(social_medical) %in% c("rate"))]
social_medical$Name <- str_replace(social_medical$Name, " County", "")
social_medical = subset(social_medical, select = -c(pov_perc_under_5))
########################################################
# Healthcare Personelle
########################################################
LCDCs_2020 <- read.delim("data_raw/LCDCs_2020.csv")
LCDCs_2020 <- LCDCs_2020[,c(1,2,3,5)]
licensed_clinical_SWs_2020 <- read.delim("data_raw/licensed_clinical_SWs_2020.csv")
licensed_clinical_SWs_2020 <- licensed_clinical_SWs_2020[,c(1,3,5)]
licensed_counselors_2020 <- read.delim("data_raw/licensed_counselors_2020.csv")
licensed_counselors_2020 <- licensed_counselors_2020[,c(1,3,5)]
social_workers_bach_2020 <- read.delim("data_raw/social_workers_bach_2020.csv")
social_workers_bach_2020 <- social_workers_bach_2020[,c(1,3,5)]
social_workers_masters_2020 <- read.delim("data_raw/social_workers_masters_2020.csv")
social_workers_masters_2020 <- social_workers_masters_2020[,c(1,3,5)]
texas_PCPs_per_capita <- read.csv("data_raw/texas_PCPs_per_capita.csv")
texas_PCPs_per_capita <- texas_PCPs_per_capita[,c(1,3,5)]
TX_health_workers_2020 <- merge(LCDCs_2020, licensed_clinical_SWs_2020, by="County")
TX_health_workers_2020 <- merge(TX_health_workers_2020, licensed_counselors_2020, by="County")
TX_health_workers_2020 <- merge(TX_health_workers_2020, social_workers_bach_2020, by="County")
TX_health_workers_2020 <- merge(TX_health_workers_2020, social_workers_masters_2020, by="County")
TX_health_workers_2020 <- merge(TX_health_workers_2020, texas_PCPs_per_capita, by="County")
TX_health_workers_2020$County <- paste(TX_health_workers_2020$County, "County")
all_urban_scores_by_FIPS <- read.csv("data_raw/all_urban_scores_by_FIPS.csv")
all_urban_scores_by_FIPS <- all_urban_scores_by_FIPS[which(all_urban_scores_by_FIPS$State=='TX'),]
TX_health_workers_2020 <- merge(TX_health_workers_2020, all_urban_scores_by_FIPS, by.x="County", by.y="County_Name", all.x=T)
TX_health_workers_2020 = subset(TX_health_workers_2020, select = -c(County))
########################################################
# Diagnosis Rates
########################################################
data_merged <- merge(social_medical, TX_health_workers_2020, by.x="fips", by.y="FIPS")
data_merged[data_merged == "."] <- NA
data_merged[data_merged == "*"] <- NA
data_merged[data_merged == ""] <- NA
data_merged$Depression <- as.numeric(data_merged$Depression)
data_merged$Alcohol_Abuse <- as.numeric(data_merged$Alcohol_Abuse)
data_merged$Autism_Spectrum_Disorders <- as.numeric(data_merged$Autism_Spectrum_Disorders)
data_merged$Drug_Abuse_Substance_Abuse <- as.numeric(data_merged$Drug_Abuse_Substance_Abuse)
data_merged$Schizophrenia_Other_Psychotic_Disorders <- as.numeric(data_merged$Schizophrenia_Other_Psychotic_Disorders)
data_merged$X2020.Total.Population <- as.numeric(gsub(",", "", data_merged$X2020.Total.Population))
########################################################
# Opioid Merge
########################################################
opioids_per_100_2020 <- read.csv("data_raw/opioids_per_100_2020.csv")
opioids_per_100_2020$FIPS <- str_pad(opioids_per_100_2020$FIPS, 5, "left", "0")
opioids_per_100_2020 <- subset(opioids_per_100_2020, select = -c(State, County))
data_merged <- merge(data_merged, opioids_per_100_2020, by.x="fips", by.y="FIPS", all.x=T)
########################################################
# Bars per Capita Merge
########################################################
# Import county pops
county_pops <- read.csv("data_raw/co-est2021-pop-48.csv")
county_pops <- county_pops[,c(1:2)]
colnames(county_pops) <- c("County", "ESTIMATESBASE2020")
county_pops$County <- gsub("\\.", "", county_pops$County)
# Import bars per county
census_2020_bars_by_county <- read.csv("data_raw/CBP_2020_alcohol_establishments.csv")
census_2020_bars_by_county = census_2020_bars_by_county[which(census_2020_bars_by_county$EMPSZES_LABEL == 'All establishments'),]
census_2020_bars_by_county = census_2020_bars_by_county[,c("NAME", "ESTAB")]
# Merge population and bars DFs
pop_bars <- merge(census_2020_bars_by_county, county_pops, by.x='NAME', by.y='County', all.y=T)
pop_bars$ESTIMATESBASE2020 <- gsub("\\,", "", pop_bars$ESTIMATESBASE2020)
pop_bars$bars_per_capita = 100000*as.numeric(pop_bars$ESTAB)/as.numeric(pop_bars$ESTIMATESBASE2020)
pop_bars <- pop_bars[,c("NAME", "bars_per_capita")]
pop_bars$NAME <- gsub(" County, Texas", "", pop_bars$NAME)
colnames(pop_bars) <- c("NAME", "alc_est_per_capita")
data_merged <- merge(data_merged, pop_bars, by.x="Name", by.y="NAME", all.x=T)
########################################################
# Veterans Merge
########################################################
VetPop2018 <- read.csv("data_raw/9L_VetPop2018_County.csv")
VetPop2018 <- VetPop2018[,c("County..St", "FIPS", "X9.30.2020")]
VetPop2018$FIPS <- str_pad(VetPop2018$FIPS, 5, pad = "0")
VetPop2018 <- VetPop2018[which(substr(VetPop2018$FIPS, start = 1, stop = 2)=='48'),]
VetPop2018$County..St <- gsub("\\,TX", "", VetPop2018$County..St)
county_pops <- read.csv("data_raw/co-est2021-pop-48.csv")
county_pops <- county_pops[,c(1:2)]
colnames(county_pops) <- c("County", "ESTIMATESBASE2020")
county_pops$County <- gsub("\\.", "", county_pops$County)
county_pops$County <- gsub("\\.", "", county_pops$County)
county_pops$County <- gsub("\\ County, Texas", "", county_pops$County)
vet_pop_merged <- merge(VetPop2018, county_pops, by.x="County..St", by.y="County")
vet_pop_merged$X9.30.2020 <- gsub("\\,", "", vet_pop_merged$X9.30.2020)
vet_pop_merged$ESTIMATESBASE2020 <- gsub("\\,", "", vet_pop_merged$ESTIMATESBASE2020)
vet_pop_merged$vet_percent_2020 <- 100*as.numeric(vet_pop_merged$X9.30.2020)/as.numeric(vet_pop_merged$ESTIMATESBASE2020)
vet_pop_merged <- vet_pop_merged[,c("FIPS", "vet_percent_2020")]
data_merged <- merge(data_merged, vet_pop_merged, by.x="fips", by.y="FIPS", all.x=T)
########################################################
# Health Insurance Merge
########################################################
uninsured_by_county <- read_excel("data_raw/aspe-uninsured-estimates-by-county.xlsx", sheet = "All Uninsured (%)")
uninsured_by_county <- uninsured_by_county[,c("FIPS Code", "Percent Uninsured" )]
colnames(uninsured_by_county) <- c("FIPS", "percent_uninsured" )
uninsured_by_county$percent_uninsured <- 100*uninsured_by_county$percent_uninsured
data_merged <- merge(data_merged, uninsured_by_county, by.x="fips", by.y="FIPS", all.x=T)
########################################################
# Mental Health Court Cases
########################################################
Mental_Health_Court_Cases <- read_excel("data_raw/Mental_Health_Court_Cases.xlsx", sheet = "2020")
colnames(Mental_Health_Court_Cases) <- c("County", "Temp_MH_Services_NewApp_2020", "Ext_MH_Services_NewApp_2020", "Modification_NewApp_2020", "Auth_Meds_NewApp_2020", "Temp_MH_Services_Hearing_2020", "Ext_MH_Services_Hearing_2020", "Modification_Hearing_2020", "Auth_Meds_Hearing_2020")
data_merged <- merge(data_merged, Mental_Health_Court_Cases, by.x="Name", by.y="County", all.x=T)
data_merged$Temp_MH_Services_NewApp_2020_per100k <- 100000*as.numeric(data_merged$Temp_MH_Services_NewApp_2020)/as.numeric(data_merged$X2020.Total.Population)
data_merged$Ext_MH_Services_NewApp_2020_per100k <- 100000*as.numeric(data_merged$Ext_MH_Services_NewApp_2020)/as.numeric(data_merged$X2020.Total.Population)
data_merged$Modification_NewApp_2020_per100k <- 100000*as.numeric(data_merged$Modification_NewApp_2020)/as.numeric(data_merged$X2020.Total.Population)
data_merged$Auth_Meds_NewApp_2020_per100k <- 100000*as.numeric(data_merged$Auth_Meds_NewApp_2020)/as.numeric(data_merged$X2020.Total.Population)
data_merged$Temp_MH_Services_Hearing_2020_per100k <- 100000*as.numeric(data_merged$Temp_MH_Services_Hearing_2020)/as.numeric(data_merged$X2020.Total.Population)
data_merged$Ext_MH_Services_Hearing_2020_per100k <- 100000*as.numeric(data_merged$Ext_MH_Services_Hearing_2020)/as.numeric(data_merged$X2020.Total.Population)
data_merged$Modification_Hearing_2020_per100k <- 100000*as.numeric(data_merged$Modification_Hearing_2020)/as.numeric(data_merged$X2020.Total.Population)
data_merged$Auth_Meds_Hearing_2020_per100k <- 100000*as.numeric(data_merged$Auth_Meds_Hearing_2020)/as.numeric(data_merged$X2020.Total.Population)
########################################################
# Psychiatrists per Capita
########################################################
texas_psychiatrists_2020 <- read.csv("data_raw/texas_psychiatrists_2020.csv")
texas_psychiatrists_2020 <- texas_psychiatrists_2020[,c("County", "X2020.Psychiatrist.Total", "Ratio.of.Psychiatrists.to.100.000.Population")]
data_merged <- merge(data_merged, texas_psychiatrists_2020, by.x="Name", by.y="County", all.x=T)
########################################################
# Traffic Fatalities
########################################################
texas_traffic_DUI_fatalities <- read_excel("data_raw/Texas_DUI_Fatalities_2019.xlsx", skip = 8)
texas_traffic_DUI_fatalities <- texas_traffic_DUI_fatalities[1:(nrow(texas_traffic_DUI_fatalities)-10),]
colnames(texas_traffic_DUI_fatalities) <- c("county", "BAC_00_count", "BAC_00_percent", "BAC_01_07_count", "BAC_01_07_percent", "BAC_gte_08_count",
"BAC_gte_08_percent", "BAC_gte_01_count", "BAC_gte_01_percent", "BAC_gte_15_count", "BAC_gte_15_percent",
"total_count", "total_percent")
texas_traffic_DUI_fatalities$county <- gsub("Texas - ", "", texas_traffic_DUI_fatalities$county)
texas_traffic_DUI_fatalities <- texas_traffic_DUI_fatalities[,c("county", "total_count", "BAC_gte_08_count", "BAC_gte_08_percent")]
colnames(texas_traffic_DUI_fatalities) <- c("County", "Total Traffic Fatalities", "Total Traffic Fatalities BAC gt 08", "Percent Traffic Fatalities BAC gt 08")
texas_traffic_DUI_fatalities$County <- str_split(texas_traffic_DUI_fatalities$County, " \\(", simplify = TRUE)[,1]
texas_traffic_DUI_fatalities$County <- tolower(texas_traffic_DUI_fatalities$County)
texas_traffic_DUI_fatalities$County <- str_to_title(texas_traffic_DUI_fatalities$County)
texas_traffic_DUI_fatalities[texas_traffic_DUI_fatalities == 'NA'] <- NA
texas_traffic_DUI_fatalities$`Total Traffic Fatalities` <- as.numeric(texas_traffic_DUI_fatalities$`Total Traffic Fatalities`)
texas_traffic_DUI_fatalities$`Total Traffic Fatalities BAC gt 08` <- as.numeric(texas_traffic_DUI_fatalities$`Total Traffic Fatalities BAC gt 08`)
texas_traffic_DUI_fatalities$`Percent Traffic Fatalities BAC gt 08` <- as.numeric(texas_traffic_DUI_fatalities$`Percent Traffic Fatalities BAC gt 08`)
data_merged <- merge(data_merged, texas_traffic_DUI_fatalities, by.x="Name", by.y="County", all.x=T)
data_merged$Traffic_Fatalities_per_100k <- (100000)*data_merged$`Total Traffic Fatalities`/as.numeric(data_merged$X2020.Total.Population)
########################################################
# Buprenorphine
########################################################
Buprenorphine <- read.csv("C:/Users/met48/Desktop/V2.1_CHERR-mental_health_data_processing/snapshot_county_data/data_raw/Buprenorphine-Waivered-Providers.csv")
Buprenorphine <- Buprenorphine[which(Buprenorphine$State=='Texas'), colnames(Buprenorphine) %in% c("County", "Total.number.of.waivered.providers", "Patient.capacity", "High.need.for.treatment.services", "Low.to.no.patient.capacity")]
Buprenorphine$County <- gsub(" County", "", Buprenorphine$County)
data_merged <- merge(data_merged, Buprenorphine, by.x="Name", by.y="County", all=T)
########################################################
# Community Health Rankings Lifestyle variables
########################################################
CHR_lifestyle <- read.csv("~/Desktop/CHERR-mental_health_map/snapshot_county_data/data_raw/CHR_lifestyle.csv")
colnames(CHR_lifestyle) <- c("FIPS", "State", "County", "Frequent_Mental_Distress", "Average_Bad_MH_Days", "Deaths_Suicide", "Suicide_Rate_AA", "Perc_Food_Insecure", "Perc_Limited_Acc_Healthy_Foods", "Perc_Physically_Inactive", "Perc_With_Acc_Exercise", "Income_80th", "Income_20th", "Income_Ratio", "Perc_Severe_Housing_Issues", "Dev2019")
CHR_lifestyle <- CHR_lifestyle[, -c(2,3)]
data_merged <- merge(data_merged, CHR_lifestyle, by.x="fips", by.y="FIPS", all=T)
library(readxl)
library(stringr)
#setwd('..')
setwd("/Users/maria/Desktop/CHERR-mental_health_map/snapshot_county_data")
########################################################
# Social/Medical Data Format
########################################################
# Import poverty rates
poverty_rates_2020 <- read_excel("data_raw/est20all.xls", skip = 3)
poverty_rates_2020$fips <- paste(poverty_rates_2020$`State FIPS Code`, poverty_rates_2020$`County FIPS Code`, sep='')
# Import chronic conditions
chronic_conditions_2018 <- read_excel("data_raw/County_Table_Chronic_Conditions_Prevalence_by_Age_2018.xlsx", sheet = "All Beneficiaries")
colnames(chronic_conditions_2018) <- c("state", "county", "fips", "Alcohol_Abuse", "Alzheimers_Disease_Dementia",
"Arthritis","Asthma",	"Atrial_Fibrillation",	"Autism_Spectrum_Disorders",
"Cancer",	"Chronic_Kidney_Disease",	"COPD",	"Depression", 	"Diabetes",
"Drug_Abuse_Substance_Abuse",	"HIV_AIDS",	"Heart_Failure", "Hepatitis_B_and_C",
"Hyperlipidemia",	"Hypertension",	"Ischemic_Heart_Disease",	"Osteoporosis",
"Schizophrenia_Other_Psychotic_Disorders", "Stroke")
chronic_conditions_2018 <- chronic_conditions_2018[6:nrow(chronic_conditions_2018),]
# Import unemployment
unemployment <- read.csv("data_raw/laucntycur14.txt", header=FALSE, sep="|")
colnames(unemployment) <- c("LAUS_area_code", "state_fips", "county_fips", "county", "period", "employed", "unemployed", "level", "rate")
unemployment <- unemployment[7:nrow(unemployment),]
unemployment$fips <- paste(unemployment$state_fips, unemployment$county_fips, sep='')
unemployment$fips <- gsub(" ", "", unemployment$fips, fixed = TRUE)
unemployment <- unemployment[which(unemployment$period=="   Mar-22  "),]
# Import incarceration
incarceration_trends <- read.csv("data_raw/incarceration-trends/incarceration_trends_texas_2018.csv")
incarceration_trends$fips <- str_pad(incarceration_trends$fips, 5, pad = "0")
# Data merge
social_medical <- merge(poverty_rates_2020, chronic_conditions_2018, by="fips")
social_medical <- merge(social_medical, unemployment, by="fips")
social_medical <- merge(social_medical, incarceration_trends, by="fips")
# Data prune/save
social_medical <- social_medical[which(social_medical$state.x == 'Texas'),]
social_medical$pov_perc_all <- social_medical$`Poverty Percent, All Ages`
social_medical$pov_perc_under_18 <- social_medical$`Poverty Percent, Age 0-17`
social_medical$pov_perc_under_5 <- social_medical$`Poverty Percent, Age 0-4`
social_medical <- social_medical[,c("fips", "Name", "pov_perc_all",
"pov_perc_under_18", "pov_perc_under_5",
"Alcohol_Abuse","Autism_Spectrum_Disorders",
"Depression", "Drug_Abuse_Substance_Abuse",
"Schizophrenia_Other_Psychotic_Disorders",
"rate", "total_pop", "total_jail_pop",
"total_jail_pretrial")]
social_medical$unemployment <- social_medical$rate
social_medical <- social_medical[,which(!colnames(social_medical) %in% c("rate"))]
social_medical$Name <- str_replace(social_medical$Name, " County", "")
social_medical = subset(social_medical, select = -c(pov_perc_under_5))
########################################################
# Healthcare Personelle
########################################################
LCDCs_2020 <- read.delim("data_raw/LCDCs_2020.csv")
LCDCs_2020 <- LCDCs_2020[,c(1,2,3,5)]
licensed_clinical_SWs_2020 <- read.delim("data_raw/licensed_clinical_SWs_2020.csv")
licensed_clinical_SWs_2020 <- licensed_clinical_SWs_2020[,c(1,3,5)]
licensed_counselors_2020 <- read.delim("data_raw/licensed_counselors_2020.csv")
licensed_counselors_2020 <- licensed_counselors_2020[,c(1,3,5)]
social_workers_bach_2020 <- read.delim("data_raw/social_workers_bach_2020.csv")
social_workers_bach_2020 <- social_workers_bach_2020[,c(1,3,5)]
social_workers_masters_2020 <- read.delim("data_raw/social_workers_masters_2020.csv")
social_workers_masters_2020 <- social_workers_masters_2020[,c(1,3,5)]
texas_PCPs_per_capita <- read.csv("data_raw/texas_PCPs_per_capita.csv")
texas_PCPs_per_capita <- texas_PCPs_per_capita[,c(1,3,5)]
TX_health_workers_2020 <- merge(LCDCs_2020, licensed_clinical_SWs_2020, by="County")
TX_health_workers_2020 <- merge(TX_health_workers_2020, licensed_counselors_2020, by="County")
TX_health_workers_2020 <- merge(TX_health_workers_2020, social_workers_bach_2020, by="County")
TX_health_workers_2020 <- merge(TX_health_workers_2020, social_workers_masters_2020, by="County")
TX_health_workers_2020 <- merge(TX_health_workers_2020, texas_PCPs_per_capita, by="County")
TX_health_workers_2020$County <- paste(TX_health_workers_2020$County, "County")
all_urban_scores_by_FIPS <- read.csv("data_raw/all_urban_scores_by_FIPS.csv")
all_urban_scores_by_FIPS <- all_urban_scores_by_FIPS[which(all_urban_scores_by_FIPS$State=='TX'),]
TX_health_workers_2020 <- merge(TX_health_workers_2020, all_urban_scores_by_FIPS, by.x="County", by.y="County_Name", all.x=T)
TX_health_workers_2020 = subset(TX_health_workers_2020, select = -c(County))
########################################################
# Diagnosis Rates
########################################################
data_merged <- merge(social_medical, TX_health_workers_2020, by.x="fips", by.y="FIPS")
data_merged[data_merged == "."] <- NA
data_merged[data_merged == "*"] <- NA
data_merged[data_merged == ""] <- NA
data_merged$Depression <- as.numeric(data_merged$Depression)
data_merged$Alcohol_Abuse <- as.numeric(data_merged$Alcohol_Abuse)
data_merged$Autism_Spectrum_Disorders <- as.numeric(data_merged$Autism_Spectrum_Disorders)
data_merged$Drug_Abuse_Substance_Abuse <- as.numeric(data_merged$Drug_Abuse_Substance_Abuse)
data_merged$Schizophrenia_Other_Psychotic_Disorders <- as.numeric(data_merged$Schizophrenia_Other_Psychotic_Disorders)
data_merged$X2020.Total.Population <- as.numeric(gsub(",", "", data_merged$X2020.Total.Population))
########################################################
# Opioid Merge
########################################################
opioids_per_100_2020 <- read.csv("data_raw/opioids_per_100_2020.csv")
opioids_per_100_2020$FIPS <- str_pad(opioids_per_100_2020$FIPS, 5, "left", "0")
opioids_per_100_2020 <- subset(opioids_per_100_2020, select = -c(State, County))
data_merged <- merge(data_merged, opioids_per_100_2020, by.x="fips", by.y="FIPS", all.x=T)
########################################################
# Bars per Capita Merge
########################################################
# Import county pops
county_pops <- read.csv("data_raw/co-est2021-pop-48.csv")
county_pops <- county_pops[,c(1:2)]
colnames(county_pops) <- c("County", "ESTIMATESBASE2020")
county_pops$County <- gsub("\\.", "", county_pops$County)
# Import bars per county
census_2020_bars_by_county <- read.csv("data_raw/CBP_2020_alcohol_establishments.csv")
census_2020_bars_by_county = census_2020_bars_by_county[which(census_2020_bars_by_county$EMPSZES_LABEL == 'All establishments'),]
census_2020_bars_by_county = census_2020_bars_by_county[,c("NAME", "ESTAB")]
# Merge population and bars DFs
pop_bars <- merge(census_2020_bars_by_county, county_pops, by.x='NAME', by.y='County', all.y=T)
pop_bars$ESTIMATESBASE2020 <- gsub("\\,", "", pop_bars$ESTIMATESBASE2020)
pop_bars$bars_per_capita = 100000*as.numeric(pop_bars$ESTAB)/as.numeric(pop_bars$ESTIMATESBASE2020)
pop_bars <- pop_bars[,c("NAME", "bars_per_capita")]
pop_bars$NAME <- gsub(" County, Texas", "", pop_bars$NAME)
colnames(pop_bars) <- c("NAME", "alc_est_per_capita")
data_merged <- merge(data_merged, pop_bars, by.x="Name", by.y="NAME", all.x=T)
########################################################
# Veterans Merge
########################################################
VetPop2018 <- read.csv("data_raw/9L_VetPop2018_County.csv")
VetPop2018 <- VetPop2018[,c("County..St", "FIPS", "X9.30.2020")]
VetPop2018$FIPS <- str_pad(VetPop2018$FIPS, 5, pad = "0")
VetPop2018 <- VetPop2018[which(substr(VetPop2018$FIPS, start = 1, stop = 2)=='48'),]
VetPop2018$County..St <- gsub("\\,TX", "", VetPop2018$County..St)
county_pops <- read.csv("data_raw/co-est2021-pop-48.csv")
county_pops <- county_pops[,c(1:2)]
colnames(county_pops) <- c("County", "ESTIMATESBASE2020")
county_pops$County <- gsub("\\.", "", county_pops$County)
county_pops$County <- gsub("\\.", "", county_pops$County)
county_pops$County <- gsub("\\ County, Texas", "", county_pops$County)
vet_pop_merged <- merge(VetPop2018, county_pops, by.x="County..St", by.y="County")
vet_pop_merged$X9.30.2020 <- gsub("\\,", "", vet_pop_merged$X9.30.2020)
vet_pop_merged$ESTIMATESBASE2020 <- gsub("\\,", "", vet_pop_merged$ESTIMATESBASE2020)
vet_pop_merged$vet_percent_2020 <- 100*as.numeric(vet_pop_merged$X9.30.2020)/as.numeric(vet_pop_merged$ESTIMATESBASE2020)
vet_pop_merged <- vet_pop_merged[,c("FIPS", "vet_percent_2020")]
data_merged <- merge(data_merged, vet_pop_merged, by.x="fips", by.y="FIPS", all.x=T)
########################################################
# Health Insurance Merge
########################################################
uninsured_by_county <- read_excel("data_raw/aspe-uninsured-estimates-by-county.xlsx", sheet = "All Uninsured (%)")
uninsured_by_county <- uninsured_by_county[,c("FIPS Code", "Percent Uninsured" )]
colnames(uninsured_by_county) <- c("FIPS", "percent_uninsured" )
uninsured_by_county$percent_uninsured <- 100*uninsured_by_county$percent_uninsured
data_merged <- merge(data_merged, uninsured_by_county, by.x="fips", by.y="FIPS", all.x=T)
########################################################
# Mental Health Court Cases
########################################################
Mental_Health_Court_Cases <- read_excel("data_raw/Mental_Health_Court_Cases.xlsx", sheet = "2020")
colnames(Mental_Health_Court_Cases) <- c("County", "Temp_MH_Services_NewApp_2020", "Ext_MH_Services_NewApp_2020", "Modification_NewApp_2020", "Auth_Meds_NewApp_2020", "Temp_MH_Services_Hearing_2020", "Ext_MH_Services_Hearing_2020", "Modification_Hearing_2020", "Auth_Meds_Hearing_2020")
data_merged <- merge(data_merged, Mental_Health_Court_Cases, by.x="Name", by.y="County", all.x=T)
data_merged$Temp_MH_Services_NewApp_2020_per100k <- 100000*as.numeric(data_merged$Temp_MH_Services_NewApp_2020)/as.numeric(data_merged$X2020.Total.Population)
data_merged$Ext_MH_Services_NewApp_2020_per100k <- 100000*as.numeric(data_merged$Ext_MH_Services_NewApp_2020)/as.numeric(data_merged$X2020.Total.Population)
data_merged$Modification_NewApp_2020_per100k <- 100000*as.numeric(data_merged$Modification_NewApp_2020)/as.numeric(data_merged$X2020.Total.Population)
data_merged$Auth_Meds_NewApp_2020_per100k <- 100000*as.numeric(data_merged$Auth_Meds_NewApp_2020)/as.numeric(data_merged$X2020.Total.Population)
data_merged$Temp_MH_Services_Hearing_2020_per100k <- 100000*as.numeric(data_merged$Temp_MH_Services_Hearing_2020)/as.numeric(data_merged$X2020.Total.Population)
data_merged$Ext_MH_Services_Hearing_2020_per100k <- 100000*as.numeric(data_merged$Ext_MH_Services_Hearing_2020)/as.numeric(data_merged$X2020.Total.Population)
data_merged$Modification_Hearing_2020_per100k <- 100000*as.numeric(data_merged$Modification_Hearing_2020)/as.numeric(data_merged$X2020.Total.Population)
data_merged$Auth_Meds_Hearing_2020_per100k <- 100000*as.numeric(data_merged$Auth_Meds_Hearing_2020)/as.numeric(data_merged$X2020.Total.Population)
########################################################
# Psychiatrists per Capita
########################################################
texas_psychiatrists_2020 <- read.csv("data_raw/texas_psychiatrists_2020.csv")
texas_psychiatrists_2020 <- texas_psychiatrists_2020[,c("County", "X2020.Psychiatrist.Total", "Ratio.of.Psychiatrists.to.100.000.Population")]
data_merged <- merge(data_merged, texas_psychiatrists_2020, by.x="Name", by.y="County", all.x=T)
########################################################
# Traffic Fatalities
########################################################
texas_traffic_DUI_fatalities <- read_excel("data_raw/Texas_DUI_Fatalities_2019.xlsx", skip = 8)
texas_traffic_DUI_fatalities <- texas_traffic_DUI_fatalities[1:(nrow(texas_traffic_DUI_fatalities)-10),]
colnames(texas_traffic_DUI_fatalities) <- c("county", "BAC_00_count", "BAC_00_percent", "BAC_01_07_count", "BAC_01_07_percent", "BAC_gte_08_count",
"BAC_gte_08_percent", "BAC_gte_01_count", "BAC_gte_01_percent", "BAC_gte_15_count", "BAC_gte_15_percent",
"total_count", "total_percent")
texas_traffic_DUI_fatalities$county <- gsub("Texas - ", "", texas_traffic_DUI_fatalities$county)
texas_traffic_DUI_fatalities <- texas_traffic_DUI_fatalities[,c("county", "total_count", "BAC_gte_08_count", "BAC_gte_08_percent")]
colnames(texas_traffic_DUI_fatalities) <- c("County", "Total Traffic Fatalities", "Total Traffic Fatalities BAC gt 08", "Percent Traffic Fatalities BAC gt 08")
texas_traffic_DUI_fatalities$County <- str_split(texas_traffic_DUI_fatalities$County, " \\(", simplify = TRUE)[,1]
texas_traffic_DUI_fatalities$County <- tolower(texas_traffic_DUI_fatalities$County)
texas_traffic_DUI_fatalities$County <- str_to_title(texas_traffic_DUI_fatalities$County)
texas_traffic_DUI_fatalities[texas_traffic_DUI_fatalities == 'NA'] <- NA
texas_traffic_DUI_fatalities$`Total Traffic Fatalities` <- as.numeric(texas_traffic_DUI_fatalities$`Total Traffic Fatalities`)
texas_traffic_DUI_fatalities$`Total Traffic Fatalities BAC gt 08` <- as.numeric(texas_traffic_DUI_fatalities$`Total Traffic Fatalities BAC gt 08`)
texas_traffic_DUI_fatalities$`Percent Traffic Fatalities BAC gt 08` <- as.numeric(texas_traffic_DUI_fatalities$`Percent Traffic Fatalities BAC gt 08`)
data_merged <- merge(data_merged, texas_traffic_DUI_fatalities, by.x="Name", by.y="County", all.x=T)
data_merged$Traffic_Fatalities_per_100k <- (100000)*data_merged$`Total Traffic Fatalities`/as.numeric(data_merged$X2020.Total.Population)
########################################################
# Buprenorphine
########################################################
Buprenorphine <- read.csv("data_raw/Buprenorphine-Waivered-Providers.csv")
Buprenorphine <- Buprenorphine[which(Buprenorphine$State=='Texas'), colnames(Buprenorphine) %in% c("County", "Total.number.of.waivered.providers", "Patient.capacity", "High.need.for.treatment.services", "Low.to.no.patient.capacity")]
Buprenorphine$County <- gsub(" County", "", Buprenorphine$County)
data_merged <- merge(data_merged, Buprenorphine, by.x="Name", by.y="County", all=T)
########################################################
# Community Health Rankings Lifestyle variables
########################################################
CHR_lifestyle <- read.csv("data_raw/CHR_lifestyle.csv")
colnames(CHR_lifestyle) <- c("FIPS", "State", "County", "Frequent_Mental_Distress", "Average_Bad_MH_Days", "Deaths_Suicide", "Suicide_Rate_AA", "Perc_Food_Insecure", "Perc_Limited_Acc_Healthy_Foods", "Perc_Physically_Inactive", "Perc_With_Acc_Exercise", "Income_80th", "Income_20th", "Income_Ratio", "Perc_Severe_Housing_Issues", "Dev2019")
CHR_lifestyle <- CHR_lifestyle[, -c(2,3)]
data_merged <- merge(data_merged, CHR_lifestyle, by.x="fips", by.y="FIPS", all=T)
View(data_merged)
data_merged$I_35 <- ifelse(data_merged$Name %in% c("Bexar", "Comal", "Hays", "Travis",
"Williamson", "Bastrop", "Caldwell",
"Guadalupe", "Kendall", "Blanco", "Burnett"),
"I-35 Corridor", "Non I-35 Corridor")
data_merged$percent_comp <- NA
for(i in 1:nrow(data_merged)){
data_merged[i,]$percent_comp <- 1-sum(is.na(data_merged[i,]))/(ncol(data_merged)-3)
}
write.csv(data_merged, "snapshot_county_data_v_2_1.csv", row.names=F, na='')
